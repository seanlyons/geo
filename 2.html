<!DOCTYPE html>
<html>
<head>
  <meta charset=utf-8 />
  <title></title>
	<script src="//code.jquery.com/jquery-1.11.3.min.js"></script>
  <script src='https://api.tiles.mapbox.com/mapbox.js/v2.2.0/mapbox.js'></script>
  <link href='https://api.tiles.mapbox.com/mapbox.js/v2.2.0/mapbox.css' rel='stylesheet' />
  <style>
    body { margin:0; padding:0; }
    .map { position:absolute; top:0; bottom:0; width:100%; }
  </style>
</head>
<body>
<div id='map-one' class='map'> </div>
<script>
var neighborhoods_layer;
var map;
var geojson;
var L;

function initialize(self_coords) {
    L.mapbox.accessToken = 'pk.eyJ1IjoiZHVlbmRlIiwiYSI6Ijk0NDg5NTU2M2Q3OGU2ZmZhMWNjYzg3MjMyOWM1YmVlIn0.dKQrnkU5ALH3ezZ9pZ4Yeg';
    sf_coords = [37.765,-122.44];
    map = L.mapbox.map('map-one', 'mapbox.streets').setView(sf_coords, 13);
    geojson = (function() {
        json = null;
        $.ajax({
            'async': false,
            'global': false,
            'url': "sf.json",
            'dataType': "json",
            'success': function (data) {
                json = data;
            }
        });
        return json;
    })();

    console.log(geojson);
    /*neighborhoods_layer = L.mapbox.featureLayer().addTo(map);
    neighborhoods_layer.setGeoJSON(geojson);*/

    neighborhoods_layer = L.geoJson(geojson, {
        fillColor: '#444',
        weight: 1
    });
    map.addLayer(neighborhoods_layer);
    L.marker(self_coords).addTo(map);

}

/*$( ".leaflet-clickable" ).click(function() {
    console.log( "Handler for .click() called." );
});*/

/*$('#map').on('click', '.trigger', function() {
    alert('Hello from Toronto!');
});*/

initialize([37.729223,-122.444564]);

console.log(neighborhoods_layer);

neighborhoods_layer.on('click', function(e) {
    self = e.layer.feature.properties.name;
    /*e.setStyle({fillColor: '#dddddd'});*/
    /*console.log(e.layer.feature.properties.name);
    console.log(e.layer.options.color);
    e.layer.options.color = '#ff0000';
    console.log(e.layer.options.color);*/
    map.eachLayer(function(layer) {
        feature = layer['feature'];
        //console.log(feature);
        if (feature
        && feature.properties
        && feature.properties.name
        && self == feature.properties.name) {
            layer.setStyle({color:'#f00', fillColor:'#f00'});
            // console.log(feature.properties.name);
        }
    });
});
</script>
</body>
</html>
